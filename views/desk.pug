<!DOCTYPE html>
html
	head
		title KOT Desk
		include ./meta.pug
		script.
			$(document).ready(function(){
				// fetch Menu
				$.get('/getMenu',
					{},
					function(data){
						if(data.error){
							alert(data.message);
						} else {
							$.each(data.message, function(index,value){
								if (value.is_default){
									$("#menu").append(new Option(value.name, value.name, true, true));
								} else {
									$("#menu").append(new Option(value.name, value.name));
								}
							});
							
							// Item Type
							$.get('/getItemType',
								{},
								function(data){
									if(data.error){
										alert(data.message);
									} else {
										$.each(data.message, function(index,value){
											$("#item_type").append(new Option(value.name, value.name));
										});
										
										// Item Category
										$.get('/getItemCategory',
											{},
											function(data){
												if(data.error){
													alert(data.message);
												} else {
													$.each(data.message, function(index,value){
														$("#item_category").append(new Option(value.name, value.name));
													});
													getFullMenu();
												}
											}
										);
									}
								}
							);
						}
					}
				);
				
				var getFullMenu = function(){
					// Get full menu
					$.post('/getFullMenu',
						{
							menu: $("#menu").val(),
							item_type: $("#item_type").val(),
							item_category: $("#item_category").val()
						},
						function(data){
							if(data.error){
								alert(data.message);
							} else {
								$("#demo").empty();
								$("#demo").append('<div class="row mainRow"></div>');

								var menuGroupId = [];
								var addHeader = function(id, value){
									$("#demo").find(".mainRow").append('<div class="col-sm-6" id="'+id+'"></div>');
									$("#demo").find("#"+id).append('<div class="panel panel-default"></div>');
									$("#demo").find("#"+id).find(".panel-default").append('<div class="panel-heading">'+value.menu_group+'</div>');
								}
								
								var addRow = function(id, value){
									var item = "";
									item += '<div class="panel-body" style="padding: 5px 5px 5px 15px; border-bottom: 1px solid #ddd;">';
									item += 	'<div class="row">';
									item += 		'<div class="col-xs-4">'+value.name+'</div>';
									item += 		'<div class="col-xs-4">Nu.'+value.rate+'</div>';
									item += 		'<div class="col-xs-4"></div>';
									item += 	'</div>';
									item += '</div>';
									$("#demo").find("#"+id).find(".panel-default").append(item);
								}
								
								$.each(data.message, function(index,value){
									var id = value.menu_group.toLowerCase().replace(/ /g,"_");
																		
									if(menuGroupId.indexOf(id) < 0){
										menuGroupId.push(id);
										addHeader(id,value);
									}
									addRow(id,value);
								}); //Each row
							}
						}
					);
				}
				
				// All
				$('#menu').change(function(){
					getFullMenu();
				});
				
				$('#item_type').change(function(){
					getFullMenu();
				});
				
				$('#item_category').change(function(){
					getFullMenu();
				});
			});
	body
		include ./navheader.pug
		
		div(class="form-group form-inline",style="margin-top: 60px; margin-left: 50px;")
			<select id="menu" class="form-control"></select>		
			 
			select(id="item_type",class="form-control")
				<option value="All" selected>All</option>
			
			 
			select(id="item_category",class="form-control")
				<option value="All" selected>All</option>

		div(class="container",id="demo") 
		